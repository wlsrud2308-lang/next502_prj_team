<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <div th:replace="~{layout/header :: header}"></div>
  <title>식당 정보 수정 | NEXT502</title>

  <style>
    :root { --main-gold: #b89255; }

    .text-gold { color: var(--main-gold) !important; }

    .btn-gold {
      background-color: var(--main-gold);
      color: white;
      border: none;
    }

    .btn-gold:hover {
      background-color: #a6834d;
      color: white;
    }

    .form-label {
      font-weight: 600;
      color: #555;
      font-size: 0.9rem;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--main-gold);
      box-shadow: 0 0 0 0.2rem rgba(184,146,85,0.25);
    }

    .photo-upload-wrapper {
      cursor: pointer;
      border: 2px dashed #ddd;
      padding: 30px;
      text-align: center;
      border-radius: 8px;
      transition: 0.3s;
    }

    .photo-upload-wrapper:hover {
      border-color: var(--main-gold);
    }
    .list-group-item {
      text-decoration: none !important;
      border: none;
      border-bottom: 1px solid #eee;
    }

    .list-group-item.active {
      background-color: #f8f9fa !important;
      color: var(--main-gold) !important;
      border-left: 4px solid var(--main-gold) !important;
      border-top: none !important;
      border-right: none !important;
      border-bottom: 1px solid #eee !important;
      outline: none !important;
    }

    .list-group-item-action:focus,
    .list-group-item-action:active {
      z-index: 1;
      color: var(--main-gold) !important;
      text-decoration: none !important;
      background-color: #f8f9fa !important;
      box-shadow: none !important;
      outline: none !important;
      border-left: 4px solid var(--main-gold) !important;
    }

  </style>
</head>

<body class="bg-light">

<div th:replace="~{layout/navbar :: navbar}"></div>

<div class="container my-5">
  <div class="row g-4">

    <!-- 사이드바 -->
    <div th:replace="~{mng/mngmenu :: adminSidebar}"></div>

    <!-- 메인 -->
    <main class="col-lg-9">

      <div class="card shadow-sm border-0 p-4 p-md-5">

        <!-- 헤더 -->
        <div class="d-flex justify-content-between align-items-center mb-4 pb-2 border-bottom">
          <h3 class="fw-bold mb-0">식당 정보 수정</h3>
          <span class="badge bg-dark px-3 py-2">Business Member</span>
        </div>

        <form th:action="@{/mngStoreUpdate}" method="post" enctype="multipart/form-data">

          <!-- restaurantId -->
          <input type="hidden" name="restaurantId"
                 th:value="${restaurant.restaurantId}" />

          <!-- 기존 이미지 값 유지용 -->
          <input type="hidden" name="existingMainImg"
                 th:value="${restaurant.mainImg}" />

          <!-- 식당 이름 / 카테고리 -->
          <div class="row">
            <div class="col-md-6 mb-4">
              <label class="form-label">식당 이름</label>
              <input type="text" class="form-control py-2"
                     name="restaurantName"
                     th:value="${restaurant.restaurantName}"
                     required>
            </div>

            <div class="col-md-6 mb-4">
              <label class="form-label">카테고리</label>
              <select class="form-select py-2" name="category">
                <option value="1" th:selected="${restaurant.category == '1'}">한식</option>
                <option value="2" th:selected="${restaurant.category == '2'}">일식</option>
                <option value="3" th:selected="${restaurant.category == '3'}">양식</option>
                <option value="4" th:selected="${restaurant.category == '4'}">중식</option>
              </select>
            </div>
          </div>

          <!-- 주소 -->
          <div class="row">
            <div class="col-md-4 mb-4">
              <label class="form-label">지역(구)</label>
              <select class="form-select py-2" name="locationTag">
                <option value="연제구" th:selected="${restaurant.locationTag == '연제구'}">연제구</option>
                <option value="해운대구" th:selected="${restaurant.locationTag == '해운대구'}">해운대구</option>
                <option value="부산진구" th:selected="${restaurant.locationTag == '부산진구'}">부산진구</option>
                <option value="수영구" th:selected="${restaurant.locationTag == '수영구'}">수영구</option>
                <option value="강서구" th:selected="${restaurant.locationTag == '강서구'}">강서구</option>
                <option value="사상구" th:selected="${restaurant.locationTag == '사상구'}">사상구</option>
                <option value="북구" th:selected="${restaurant.locationTag == '북구'}">북구</option>
                <option value="서구" th:selected="${restaurant.locationTag == '서구'}">서구</option>
                <option value="동구" th:selected="${restaurant.locationTag == '동구'}">동구</option>
                <option value="중구" th:selected="${restaurant.locationTag == '중구'}">중구</option>
                <option value="영도구" th:selected="${restaurant.locationTag == '영도구'}">영도구</option>
                <option value="남구" th:selected="${restaurant.locationTag == '남구'}">남구</option>
                <option value="동래구" th:selected="${restaurant.locationTag == '동래구'}">동래구</option>
                <option value="금정구" th:selected="${restaurant.locationTag == '금정구'}">금정구</option>
                <option value="기장군" th:selected="${restaurant.locationTag == '기장군'}">기장군</option>
              </select>
            </div>

            <div class="col-md-8 mb-4">
              <label class="form-label">상세 주소</label>
              <input type="text" class="form-control py-2"
                     name="address"
                     th:value="${restaurant.address}">
            </div>
          </div>

          <!-- 인원 / 가격 -->
          <div class="row">
            <div class="col-md-6 mb-4">
              <label class="form-label">최대 수용 인원</label>
              <input type="number" class="form-control py-2"
                     name="maxCapacity"
                     th:value="${restaurant.maxCapacity}">
            </div>

            <div class="col-md-6 mb-4">
              <label class="form-label">대표 가격</label>
              <input type="number" class="form-control py-2"
                     name="price"
                     th:value="${restaurant.price}">
            </div>
          </div>

          <hr class="my-4 text-muted opacity-25">

          <!-- 소개글 -->
          <div class="mb-4">
            <label class="form-label">식당 소개글</label>
            <textarea class="form-control py-2"
                      rows="5"
                      name="itemCntnts"
                      th:text="${restaurant.itemCntnts}"></textarea>
          </div>

          <!-- 대표 이미지 -->
          <div class="mb-4">
            <label class="form-label">대표 이미지</label>

            <!-- Controller와 이름 맞춤 -->
            <input type="file"
                   id="mainImg"
                   name="mainImgFile"
                   class="d-none"
                   accept="image/*"
                   onchange="previewImage(this)">

            <label for="mainImg" class="photo-upload-wrapper d-block">

              <div id="preview-container">

                <!-- 기존 이미지 -->
                <img th:if="${restaurant.mainImg}"
                     th:src="@{${restaurant.mainImg}}"
                     class="img-fluid shadow-sm"
                     style="max-height:250px;">

                <!-- 이미지 없을 때 -->
                <div th:unless="${restaurant.mainImg}">
                  <i class="bi bi-image fs-1 text-muted"></i>
                  <p class="text-muted mt-2">클릭하여 이미지 업로드</p>
                </div>

              </div>

              <p class="mt-2 text-gold fw-bold">이미지를 클릭하면 변경됩니다.</p>

            </label>
          </div>

          <!-- 버튼 -->
          <div class="col-12 d-flex justify-content-between mt-4">
            <button type="button"
                    class="btn btn-outline-secondary px-4"
                    onclick="history.back()">
              취소
            </button>

            <button type="submit"
                    class="btn btn-gold px-5">
              정보 업데이트
            </button>
          </div>

        </form>
      </div>
    </main>
  </div>
</div>

<div th:replace="~{layout/footer :: footer}"></div>

<script>
  function previewImage(input) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();

      reader.onload = function(e) {
        document.getElementById('preview-container').innerHTML =
                `<img src="${e.target.result}" class="img-fluid shadow-sm" style="max-height:250px;">
           <p class="mt-2 text-gold fw-bold">이미지가 선택되었습니다.</p>`;
      }

      reader.readAsDataURL(input.files[0]);
    }
  }
</script>

</body>
</html>


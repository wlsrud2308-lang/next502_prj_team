<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <div th:replace="~{layout/header :: header}"></div>
  <title>NEXT502 | 식당 정보 수정</title>
  <style>
    :root { --main-gold: #b89255; }

    body { background-color: #f8f9fa; }

    .form-control, .form-select {
      border-color: #eee; color: #333;
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--main-gold);
      box-shadow: 0 0 0 0.25rem rgba(184, 146, 85, 0.1);
    }
    .form-control::placeholder { color: #bbb !important; font-weight: 300; font-size: 0.9rem; transition: all 0.3s ease; }
    .form-control:focus::placeholder { opacity: 0; transform: translateX(10px); }

    .btn-gold { background-color: var(--main-gold); color: white; border: none; }
    .btn-gold:hover { background-color: #a6834d; }

    .aside-menu {
      background: #fff; border-right: 1px solid #eee; min-height: 100vh; padding-top: 2rem;
    }
    .aside-menu a { display: block; padding: 0.75rem 1rem; color: #555; text-decoration: none; }
    .aside-menu a.active, .aside-menu a:hover { background-color: #f8f9fa; color: var(--main-gold); font-weight: bold; border-left: 4px solid var(--main-gold); }

    .preview-img { max-height: 250px; border-radius: 4px; }
  </style>
</head>
<body>

<div th:replace="~{layout/navbar :: navbar}"></div>

<main class="container-fluid my-5">
  <div class="row">
    <!-- 사이드바 -->
    <aside class="col-md-3 aside-menu">
      <a href="/mng/mngmenu" class="active">예약 관리</a>
      <a href="/mng/mngreview">리뷰 관리</a>
      <a href="/mng/mngmypage">내 정보</a>
      <a href="/mng/store/edit">식당 정보 수정</a>
      <a href="/mng/account">계정 관리</a>
    </aside>

    <!-- 메인 콘텐츠 -->
    <section class="col-md-9">
      <div class="card shadow-sm border-0">
        <div class="card-body p-5">

          <!-- 알림 메시지 -->
          <div th:if="${alertMessage}" class="mb-4">
            <div th:class="'alert alert-' + ${alertType} + ' alert-dismissible fade show'" role="alert">
              <span th:text="${alertMessage}"></span>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          </div>

          <h3 class="fw-bold mb-4 pb-2 border-bottom">식당 정보 수정</h3>

          <form th:action="@{/mng/store/update}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="restaurantId" th:value="${restaurant != null ? restaurant.id : 0}" />

            <!-- 기본 정보 -->
            <h5 class="mb-3">기본 정보</h5>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label class="form-label">식당 이름</label>
                <input type="text" class="form-control form-control-lg" name="restaurantName"
                       th:value="${restaurant != null ? restaurant.name : ''}" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">카테고리</label>
                <select class="form-select form-select-lg" name="category">
                  <option th:value="1" th:selected="${restaurant.category == 1}">한식</option>
                  <option th:value="2" th:selected="${restaurant.category == 2}">일식</option>
                  <option th:value="3" th:selected="${restaurant.category == 3}">양식</option>
                  <option th:value="4" th:selected="${restaurant.category == 4}">중식</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">지역(구)</label>
                <select class="form-select" name="locationTag">
                  <option th:value="연제구" th:selected="${restaurant.locationTag == '연제구'}">연제구</option>
                  <option th:value="해운대구" th:selected="${restaurant.locationTag == '해운대구'}">해운대구</option>
                  <option th:value="부산진구" th:selected="${restaurant.locationTag == '부산진구'}">부산진구</option>
                  <option th:value="수영구" th:selected="${restaurant.locationTag == '수영구'}">수영구</option>
                  <option th:value="강서구" th:selected="${restaurant.locationTag == '강서구'}">강서구</option>
                  <option th:value="사상구" th:selected="${restaurant.locationTag == '사상구'}">사상구</option>
                  <option th:value="북구" th:selected="${restaurant.locationTag == '북구'}">북구</option>
                  <option th:value="서구" th:selected="${restaurant.locationTag == '서구'}">서구</option>
                  <option th:value="동구" th:selected="${restaurant.locationTag == '동구'}">동구</option>
                  <option th:value="중구" th:selected="${restaurant.locationTag == '중구'}">중구</option>
                  <option th:value="영도구" th:selected="${restaurant.locationTag == '영도구'}">영도구</option>
                  <option th:value="남구" th:selected="${restaurant.locationTag == '남구'}">남구</option>
                  <option th:value="동래구" th:selected="${restaurant.locationTag == '동래구'}">동래구</option>
                  <option th:value="금정구" th:selected="${restaurant.locationTag == '금정구'}">금정구</option>
                  <option th:value="기장군" th:selected="${restaurant.locationTag == '기장군'}">기장군</option>
                </select>
              </div>
              <div class="col-md-8">
                <label class="form-label">상세 주소</label>
                <input type="text" class="form-control" name="address" th:value="${restaurant.address}">
              </div>
            </div>

            <!-- 운영 정보 -->
            <h5 class="mb-3">운영 정보</h5>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label class="form-label">최대 수용 인원</label>
                <input type="number" class="form-control" name="seats" th:value="${restaurant.seats}">
              </div>
              <div class="col-md-6">
                <label class="form-label">대표 가격 (1인 기준)</label>
                <input type="number" class="form-control" name="price" th:value="${restaurant.price}">
              </div>
              <div class="col-12">
                <label class="form-label">식당 소개글</label>
                <textarea class="form-control" name="description" rows="5" th:text="${restaurant.description}"></textarea>
              </div>
            </div>

            <!-- 이미지 수정 -->
            <h5 class="mb-3">대표 이미지</h5>
            <div class="mb-5">
              <input type="file" id="mainImg" name="mainImg" class="d-none" accept="image/*" onchange="previewImage(this)">
              <label for="mainImg" class="d-block">
                <div id="preview-container">
                  <div th:if="${restaurant.mainImg != null}">
                    <img th:src="${restaurant.mainImg}" class="preview-img">
                    <p class="text-gold fw-bold mt-2">기존 이미지입니다. 클릭하면 변경 가능합니다.</p>
                  </div>
                  <div th:if="${restaurant.mainImg == null}">
                    <i class="bi bi-image fs-1 text-muted"></i>
                    <p class="text-muted mt-2 mb-0">클릭하여 이미지 업로드</p>
                    <small class="text-secondary">JPG, PNG (최대 5MB)</small>
                  </div>
                </div>
              </label>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-gold btn-lg">식당 정보 수정 완료</button>
              <a href="/mng/mngmenu" class="btn btn-outline-secondary mt-2">취소하고 목록으로 돌아가기</a>
            </div>
          </form>

        </div>
      </div>
    </section>
  </div>
</main>

<div th:replace="~{layout/footer :: footer}"></div>

<script>
  function previewImage(input) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('preview-container').innerHTML = `
          <img src="${e.target.result}" class="preview-img">
          <p class="text-gold fw-bold mt-2">이미지가 선택되었습니다. 다시 클릭하면 변경 가능합니다.</p>`;
      }
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>

</body>
</html>
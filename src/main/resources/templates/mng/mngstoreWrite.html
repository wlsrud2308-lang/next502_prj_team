<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <div th:replace="~{layout/header :: header}"></div>
  <title>NEXT502 | 식당 등록 관리</title>

  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=lpdvoku5d1"></script>




  <style>
      .form-control, .form-select {
          border-color: #eee;
          color: #333;
      }

      .form-control:focus, .form-select:focus {
          border-color: var(--main-gold);
          box-shadow: 0 0 0 0.25rem rgba(184, 146, 85, 0.1);
      }

      .form-control::placeholder {
          color: #bbb !important;
          font-weight: 300 !important;
          font-size: 0.9rem;
          transition: all 0.3s ease;
      }

      .form-control:focus::placeholder {
          opacity: 0;
          transform: translateX(10px);
      }

      .form-control-lg::placeholder {
          font-size: 1rem;
      }

      input[type="number"] {
          text-align: right;
      }

      /*.btn-gold {*/
      /*    background-color: #b89255;*/
      /*    color: white;*/
      /*    border: none;*/
      /*    transition: 0.3s;*/
      /*}*/

      :root { --main-gold: #b89255; }
      .text-gold { color: var(--main-gold) !important; }
      .btn-gold { background-color: var(--main-gold); color: white; border: none; }
      .btn-gold:hover { background-color: #a6834d; color: white; }

      .list-group-item { text-decoration: none !important; border: none; border-bottom: 1px solid #eee; }
      .list-group-item.active {
          background-color: #f8f9fa !important;
          color: var(--main-gold) !important;
          border-left: 4px solid var(--main-gold) !important;
          font-weight: bold;
      }

      .form-label { font-weight: 600; color: #555; font-size: 0.9rem; }
      .form-control:focus { border-color: var(--main-gold); box-shadow: 0 0 0 0.2rem rgba(184, 146, 85, 0.25); }
      .profile-img-sec { position: relative; width: 120px; height: 120px; margin: 0 auto; }
      .admin-badge { position: absolute; bottom: 0; right: 0; background: #212529; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; }
  </style>
</head>
<body class="bg-light">

<div th:replace="~{layout/navbar :: navbar}"></div>

<main class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-9">
      <div class="card shadow-sm border-0">
        <div class="card-body p-5">

          <!-- ✅ 알림 메시지 -->
          <div th:if="${alertMessage}" class="mb-4">
            <div th:class="'alert alert-' + ${alertType} + ' alert-dismissible fade show'" role="alert">
              <span th:text="${alertMessage}"></span>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          </div>

          <h3 class="fw-bold mb-4 pb-2 border-bottom">신규 식당 등록 <span class="fs-6 text-muted fw-normal ms-2">Admin Only</span></h3>

          <form th:action="@{/mngstoreWrite}" method="post" enctype="multipart/form-data">

            <h5 class="section-title">기본 정보</h5>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="restaurantName" class="form-label">식당 이름</label>
                <input type="text" class="form-control form-control-lg" id="restaurantName" name="restaurantName" placeholder="예: 레스토랑 NEXT502" required>
              </div>
              <div class="col-md-6">
                <label for="category" class="form-label">카테고리</label>
                <select class="form-select form-select-lg" id="category" name="category">
                  <option value="1">한식</option>
                  <option value="2">일식</option>
                  <option value="3">양식</option>
                  <option value="4">중식</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="locationTag" class="form-label">지역(구)</label>
                <select class="form-select" id="locationTag" name="locationTag">
                  <option value="연제구">연제구</option>
                  <option value="해운대구">해운대구</option>
                  <option value="부산진구">부산진구</option>
                  <option value="수영구">수영구</option>
                  <option value="강서구">강서구</option>
                  <option value="사상구">사상구</option>
                  <option value="북구">북구</option>
                  <option value="서구">서구</option>
                  <option value="동구">동구</option>
                  <option value="중구">중구</option>
                  <option value="영도구">영도구</option>
                  <option value="남구">남구</option>
                  <option value="동래구">동래구</option>
                  <option value="금정구">금정구</option>
                  <option value="기장군">기장군</option>
                </select>
              </div>
              <div class="col-md-8">
                <label for="address" class="form-label">상세 주소</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="address" name="address" placeholder="주소 검색 버튼을 눌러주세요" readonly required>
                  <button class="btn btn-outline-gold" type="button" onclick="searchAddress()">주소 검색</button>
              </div>
            </div>
              <input type="hidden" id="lat" name="lat">
              <input type="hidden" id="lng" name="lng">

            <h5 class="section-title mt-5">운영 정보</h5>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="seats" class="form-label">최대 수용 인원 (명)</label>
                <div class="input-group">
                  <input type="number" class="form-control" id="seats" name="seats" placeholder="40">
                  <span class="input-group-text">명</span>
                </div>
              </div>
              <div class="col-md-6">
                <label for="price" class="form-label">대표 가격 (1인 기준)</label>
                <div class="input-group">
                  <input type="number" class="form-control" id="price" name="price" placeholder="150,000">
                  <span class="input-group-text">원</span>
                </div>
              </div>
              <div class="col-12">
                <label for="description" class="form-label">식당 소개글</label>
                <textarea class="form-control" id="description" name="description" rows="5" placeholder="상세 페이지 상단에 노출될 매력적인 소개글을 적어주세요."></textarea>
              </div>
            </div>

            <h5 class="section-title mt-5">이미지 등록</h5>
            <div class="mb-5">
              <label class="form-label">대표 이미지 (배경용)</label>
              <input type="file" id="mainImg" name="mainImgFile" class="d-none" accept="image/*" onchange="previewImage(this)">
              <label for="mainImg" class="photo-upload-wrapper d-block">
                <div id="preview-container">
                  <i class="bi bi-image fs-1 text-muted"></i>
                  <p class="mt-2 mb-0 text-muted">클릭하여 대표 이미지를 업로드하세요</p>
                  <small class="text-secondary">JPG, PNG (최대 5MB)</small>
                </div>
              </label>
            </div>

            <div class="d-grid gap-2 mt-5">
              <button type="submit" class="btn btn-gold btn-lg shadow d-flex align-items-center justify-content-center py-3 border-0 transition-all">
                <i class="bi bi-check-circle-fill me-2"></i> <span>식당 정보 등록 완료</span>
              </button>

              <a href="/mngmenu" class="btn btn-outline-secondary border-0 mt-2">
                <i class="bi bi-arrow-left me-1"></i> 취소하고 목록으로 돌아가기
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</main>

<div th:replace="~{layout/footer :: footer}"></div>

<script>
  // 주소 검색 함수
  function searchAddress() {
    new daum.Postcode({
      oncomplete: function(data) {

        const addr = data.roadAddress || data.jibunAddress;

        console.log("주소:", addr);

        document.getElementById("address").value = addr;

        naver.maps.Service.geocode({
          query: addr
        }, function(status, response) {

          if (status !== naver.maps.Service.Status.OK) {
            alert("좌표 변환 실패");
            return;
          }

          if (!response.v2.addresses || response.v2.addresses.length === 0) {
            alert("좌표 결과 없음");
            return;
          }

          const result = response.v2.addresses[0];

          document.getElementById("lat").value = result.y;
          document.getElementById("lng").value = result.x;

          console.log("좌표 성공", result.y, result.x);
        });

      }
    }).open();
  }

  // 이미지 미리보기
  function previewImage(input) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const container = document.getElementById('preview-container');
        container.innerHTML = `<img src="${e.target.result}" style="max-height: 250px; border-radius: 4px;" class="img-fluid shadow-sm">
                                       <p class="mt-2 mb-0 text-gold fw-bold">이미지가 선택되었습니다. 다시 클릭하면 변경 가능합니다.</p>`;
      }
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>

</body>
</html>
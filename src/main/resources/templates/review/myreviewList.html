<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="~{layout/header :: header}"></div>
    <title>NEXT502 | ë‚˜ì˜ ë¦¬ë·°</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <style>
        :root { --main-gold: #b89255; --main-gold-hover: #9c7b46; }

        .text-gold { color: var(--main-gold) !important; }
        .bg-gold-subtle { background-color: #fcf8f3; color: var(--main-gold); }

        /* ì‚¬ì´ë“œë°” ë©”ë‰´  */
        .list-group-item.active {
            background-color: transparent;
            color: var(--main-gold);
            font-weight: bold;
            border-color: #eee;
            border-left: 3px solid var(--main-gold); /* ì™¼ìª½ ê°•ì¡° ì„  */
        }
        .list-group-item { border-left: 3px solid transparent; transition: all 0.2s; }
        .list-group-item:hover { color: var(--main-gold); background-color: #f9f9f9; }

        /*

        /* ë²„íŠ¼ ì»¤ìŠ¤í…€ */
        .btn-outline-gold {
            color: var(--main-gold); border-color: var(--main-gold);
        }
        .btn-outline-gold:hover {
            background-color: var(--main-gold); color: white;
        }

        /* ë³„ì  */
        .stars {
            display: flex;
            justify-content: center;
            gap: 6px;
            font-size: 2rem;
            color: #ddd;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .stars span:hover,
        .stars span.active {
            color: #f2b01e;
        }

        /*ë¦¬ìŠ¤íŠ¸ í‰ì ‘í‘œì‹œ*/
        .star-meter {
            position: relative;
            display: inline-block;
            font-size: 1.1rem;
            letter-spacing: 2px;
            line-height: 1;
            vertical-align: middle;
        }
        .star-meter .stars-bg { color: #d7d7d7; }
        .star-meter .stars-fill {
            position: absolute;
            left: 0;
            top: 0;
            width: 0%;
            overflow: hidden;
            white-space: nowrap;
            color: var(--main-gold);
        }
        /* í˜ì´ì§€ í‘œì‹œ*/
        .page-link {
            color: var(--main-gold); border-color: var(--main-gold);
            border: none;
        }
        .page-link:hover {
            background-color: var(--main-gold); color: white;
        }
        .active>.page-link {
            background-color: var(--main-gold);
            color:white;
            font-weight: bold;
            border-color: var(--main-gold);
        }
        .page-link.active {
            background-color: transparent;
            color:var(--main-gold);
            font-weight: bold;
            border-color: transparent;
        }
       /*ëŒ“ê¸€ ì¸ë„¤ì¼ */
        .img-loading {
            width:100px;
            height:100px;
            border-radius: 4px;
        }

    </style>

</head>
<body class="d-flex flex-column min-vh-100 bg-light">

<div th:replace="~{layout/navbar :: navbar}"></div>


<main class="container my-5">
    <div class="row g-4">
        <aside class="col-lg-3">
            <div class="card shadow-sm border-0 mb-4">

                <div class="card-body text-center p-4">
                    <div class="bg-secondary bg-opacity-10 rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                        <i class="bi bi-person-fill fs-1 text-secondary"></i>
                    </div>

                    <h5 class="fw-bold mb-1" th:text="${session.loginUser.name} + 'ë‹˜'">í™ê¸¸ë™ë‹˜</h5>

                </div>

                <div class="list-group list-group-flush small">
                    <a th:href="@{/mypage/main}" class="list-group-item list-group-item-action py-3 px-4">
                        <i class="bi bi-calendar me-2"></i> ë‚˜ì˜ ì˜ˆì•½ ë‚´ì—­
                    </a>
                    <a th:href="@{/mypage/mybookmarkList}" class="list-group-item list-group-item-action py-3 px-4 d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-heart me-2"></i> ê´€ì‹¬ ì‹ë‹¹</span>
                        <span class="badge bg-secondary bg-opacity-10 text-dark rounded-pill" th:text="${bookmarkList != null ? #lists.size(bookmarkList) : 0}">0</span>
                    </a>
                    <a th:href="@{/review/myreviewList(userId=${session.loginUser.userId})}" class="list-group-item list-group-item-action py-3 px-4 active" >
                        <i class="bi bi-pencil-square me-2"></i>ë‚´ê°€ ì“´ ë¦¬ë·°
                    </a>
                    <a th:href="@{/mypage/mypageList}" class="list-group-item list-group-item-action py-3 px-4">
                        <i class="bi bi-gear me-2"></i> ê°œì¸ì •ë³´ ìˆ˜ì •
                    </a>
                </div>
            </div>
        </aside>

        <section class="col-lg-9">
            <div class="card shadow-sm border-0 min-vh-100">
                <div class="card-body p-4 p-md-5">
                    <h4 class="fw-bold mb-4 pb-2 border-bottom">ë‚´ê°€ ì“´ ë¦¬ë·°</h4>

                    <div th:if="${#lists.size(reviewList.getList())} > 0" >
                            <div th:each="review : ${reviewList.getList()}">

                                    <div class="card mb-3 border-light-subtle shadow-sm">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between mb-2">
                                                <h5 class="card-title fw-bold mb-0"><span th:text="${review.storeName}"></span></h5>

                                                <small class="text-muted" th:text="${review.createDate}">2026.02.01 ì‘ì„±</small>
                                            </div>
                                            <div class="star-meter mb-2">
                                                <div class="stars-bg">â˜…â˜…â˜…â˜…â˜…</div>
                                                <div class="stars-fill" th:style="'width:' + (${review.rating} * 20) + '%'">â˜…â˜…â˜…â˜…â˜…</div>

                                            </div>
                                            <p class="card-text text-secondary"><span th:text="${review.comment}">êµ­ë¬¼ì´ ì •ë§ ì‹œì›í•˜ê³  ë§›ìˆì—ˆì–´ìš”. </span></p>
                                            <div th:if="${review.replyContent != null}"
                                                 class="mt-3 mb-3 p-2 border-start border-3 ps-3 italic small bg-light">
                                                <strong>[Re]</strong> <span th:text="${review.replyContent}"></span>
                                            </div>
                                            <div>
                                                <img alt="272513510053900.jpg" src="https://github.com/wlsrud2308-lang/next502_prj_team/blob/main/src/main/resources/static/images/2026-02-13/272513510053900.jpg?raw=true" data-hpc="true" class="Box-sc-62in7e-0 eLrlvS img-loading"/>
                                                <img th:src="@{'/images/2026-02-13/272513510053900.jpg'}" class="img-loading"/>
                                            </div>
                                            <div class="text-end">
                                                <button class="btn btn-outline-gold btn-sm px-3 btnuptate" th:attrappend="data-storeName=${review.storeName},
                                                                   data-reviewIdx=${review.reviewIdx},data-rating=${review.rating},data-comment=${review.comment}">ë¦¬ë·°ìˆ˜ì •</button>
                                                <button class="btn btn-sm btn-outline-danger btndel2" id="" th:attrappend="id=${review.reviewIdx}">ì‚­ì œ</button>

                                            </div>
                                        </div>
                                    </div>
                            </div>

                            <!--      í˜ì´ì§€ì‹œì‘-->
                            <div class="mt-3">
                                <ul class="pagination justify-content-center">
                                     <li class="page-item" th:classappend="${reviewList.getPrePage() == 0} ? 'disabled'">
                                        <a href="#" th:href="@{/review/myreviewList(pageNum=${page},userId=${session.loginUser.userId})}" class="page-link"> &laquo;</a>
                                    </li>
                                    <li class="page-item" th:each="page : ${#numbers.sequence(reviewList.getNavigateFirstPage(), reviewList.getNavigateLastPage())}" th:classappend="${page == reviewList.getPageNum()} ? 'active'">
                                        <a href="#" th:href="@{/review/myreviewList(pageNum=${page},userId=${session.loginUser.userId})}" th:text="${page}" class="page-link">1</a>
                                    </li>
                                    <li class="page-item" th:classappend="${reviewList.getNextPage() == 0} ? 'disabled'">
                                        <a href="#" th:href="@{/review/myreviewList(pageNum=${page},userId=${session.loginUser.userId})}" class="page-link">&raquo;</a>
                                    </li>
                                </ul>
                            </div>
                        <!--      í˜ì´ì§€ë-->
                    </div>
                    <div th:unless="${#lists.size(reviewList.getList())} > 0">
                        <div class="card mb-3 border-light-subtle shadow-sm">
                            <div class="card-body">
                                <div class="text-center py-5 text-muted">ë¦¬ë·° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                            </div>
                        </div>
                    </div>



                </div>
            </div>
        </section>
    </div>
</main>

<!------------------------------------------------------------------------------------->

<div class="modal fade" id="reviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 480px;">
        <div class="modal-content rounded-4 shadow-lg border-0">

            <div class="modal-header border-bottom-0 pt-4 px-4">
                <h5 class="modal-title fw-bold fs-5">ë¦¬ë·° ìˆ˜ì •</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body px-4 pb-4">
                <h4 id="modalStoreName" class="text-center fw-bold mb-4 text-gold" style="font-size: 1.4rem;"></h4>

                <form action="/review/reviewUpdate" method="post" enctype="multipart/form-data">
                    <input type="hidden" id="modalReviewId" name="reviewIdx">
                    <input type="hidden" id="modalRatingValue" name="rating" value="0">
                    <input type="hidden" id="modalImgUrl" name="imgUrl" value="" >
                    <input type="hidden" name="userId" th:value="${session.loginUser.userId}">

                    <div class="mb-4 text-center">
                        <p class="text-muted small mb-2">ì‹ì‚¬ëŠ” ë§Œì¡±ìŠ¤ëŸ¬ìš°ì…¨ë‚˜ìš”?</p>
                        <div class="stars">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                        </div>
                        <div class="hint">ë³„ì„ í´ë¦­í•˜ì—¬ ì ìˆ˜ë¥¼ ë§¤ê²¨ì£¼ì„¸ìš”.</div>


                    </div>
                    <div class="mb-3">
                        <textarea class="form-control bg-light border-0" id="modalComment" name="comment" rows="4"
                                  placeholder="ì†”ì§í•œ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”. (ìµœì†Œ 10ì ì´ìƒ)" required style="resize: none; font-size: 0.9rem;"></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="form-label text-muted small mb-1">ğŸ“· ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label>
                        <input class="form-control form-control-sm" type="file" id="uploadFiles" name="uploadFiles" accept="image/*">
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-outline-gold py-2 fw-bold"
                                style="background-color: var(--main-gold); color: white;">
                            í™• ì¸
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    $(function() {
        // 1. ì„œë²„ì—ì„œ ì „ë‹¬ëœ ì•Œë¦¼ ë©”ì‹œì§€ ì²˜ë¦¬
        const msg = [[${msg}]];
        if (msg) {
            alert(msg);
        }

        // 2. ë³„ì  ìŠ¤í¬ë¦½íŠ¸ (ê¸°ì¡´ ìœ ì§€)
        const stars = document.querySelectorAll('.stars .star');
        const ratingInput = document.getElementById('modalRatingValue');
        let selectedRating = 0;

        function updateStars(val) {
            stars.forEach(star => {
                star.classList.toggle('active', star.dataset.value <= val);
            });
        }

        stars.forEach(star => {
            star.addEventListener('click', () => {
                selectedRating = star.dataset.value;
                ratingInput.value = selectedRating;
                updateStars(selectedRating);
            });
            star.addEventListener('mouseover', () => updateStars(star.dataset.value));
            star.addEventListener('mouseout', () => updateStars(selectedRating));
        });

        // 3. ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° (ê¸°ì¡´ ìœ ì§€)
        $(".btnuptate").on("click", function() {
            const btn = $(this);
            const name = btn.attr("data-storeName");
            const idx = btn.attr("data-reviewIdx");
            const rating = btn.attr("data-rating");
            const comment = btn.attr("data-comment");

            $('#modalStoreName').text(name);
            $('#modalReviewId').val(idx);
            $('#modalRatingValue').val(rating);
            $('#modalComment').val(comment);
            updateStars(rating);
            selectedRating = rating;

            new bootstrap.Modal(document.getElementById('reviewModal')).show();
        });

        // 4. ì‚­ì œ ë²„íŠ¼ (Confirm ì¶”ê°€ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œ ëŒ€ì‘)
        $(".btndel2").on("click", function() {
            const reviewIdx = $(this).attr("id");
            // ì„¸ì…˜ì´ë‚˜ ë‹¤ë¥¸ ê³³ì—ì„œ userIdë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜, ë²„íŠ¼ì— data-useridë¥¼ ì‹¬ì–´ì„œ ì‚¬ìš©í•˜ì„¸ìš”.
            const userId = [[${session.loginUser.userId}]];

            if (confirm("ì •ë§ë¡œ ì´ ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                location.href = "/review/delReview?reviewIdx=" + reviewIdx + "&userId=" + userId;
            }
        });
    });
</script>
<div th:replace="~{layout/footer :: footer}"></div>
</body>
</html>
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="~{layout/header :: header}"></div>
    <title>NEXT502 | ë‚˜ì˜ ë¦¬ë·°</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <style>
        :root { --main-gold: #b89255; --main-gold-hover: #9c7b46; }

        .text-gold { color: var(--main-gold) !important; }
        .bg-gold-subtle { background-color: #fcf8f3; color: var(--main-gold); }

        /* ì‚¬ì´ë“œë°” ë©”ë‰´  */
        .list-group-item.active {
            background-color: transparent;
            color: var(--main-gold);
            font-weight: bold;
            border-color: #eee;
            border-left: 3px solid var(--main-gold); /* ì™¼ìª½ ê°•ì¡° ì„  */
        }
        .list-group-item { border-left: 3px solid transparent; transition: all 0.2s; }
        .list-group-item:hover { color: var(--main-gold); background-color: #f9f9f9; }

        /* ë²„íŠ¼ ì»¤ìŠ¤í…€ */
        .btn-outline-gold {
            color: var(--main-gold); border-color: var(--main-gold);
        }
        .btn-outline-gold:hover {
            background-color: var(--main-gold); color: white;
        }

        /* ë³„ì  */
        .stars {
            display: flex;
            justify-content: center;
            gap: 6px;
            font-size: 2rem;
            color: #ddd;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .stars span:hover,
        .stars span.active {
            color: #f2b01e;
        }

        /*ë¦¬ìŠ¤íŠ¸ í‰ì ‘í‘œì‹œ*/
        .star-meter {
            position: relative;
            display: inline-block;
            font-size: 1.1rem;
            letter-spacing: 2px;
            line-height: 1;
            vertical-align: middle;
        }
        .star-meter .stars-bg { color: #d7d7d7; }
        .star-meter .stars-fill {
            position: absolute;
            left: 0;
            top: 0;
            width: 0%;
            overflow: hidden;
            white-space: nowrap;
            color: var(--main-gold);
        }

    </style>

</head>
<body class="d-flex flex-column min-vh-100 bg-light">

<div th:replace="~{layout/navbar :: navbar}"></div>


<main class="container my-5">
    <div class="row g-4">
        <aside class="col-lg-3">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body text-center p-4">
                    <div class="bg-secondary bg-opacity-10 rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                        <i class="bi bi-person-fill fs-1 text-secondary"></i>
                    </div>
                    <h5 class="fw-bold mb-1">í™ê¸¸ë™ë‹˜</h5>
                    <p class="text-muted small mb-0">ì¼ë°˜ íšŒì›</p>
                </div>
                <div class="list-group list-group-flush small">
                    <a th:href="@{/mypage/main}" class="list-group-item list-group-item-action py-3 px-4">
                        <i class="bi bi-calendar me-2"></i> ë‚˜ì˜ ì˜ˆì•½ ë‚´ì—­
                    </a>
                    <a th:href="@{/mybookmarkList}" class="list-group-item list-group-item-action py-3 px-4 d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-heart me-2"></i> ê´€ì‹¬ ì‹ë‹¹</span>
                        <span class="badge bg-secondary bg-opacity-10 text-dark rounded-pill">5</span>
                    </a>
                    <a th:href="@{/review/myreviewList(userId=${session.loginUser.userId})}" class="list-group-item list-group-item-action py-3 px-4">
                        <i class="bi bi-pencil-square me-2"></i>ë‚´ê°€ ì“´ ë¦¬ë·°
                    </a>
                    <a th:href="@{/mypageList}" class="list-group-item list-group-item-action py-3 px-4">
                        <i class="bi bi-gear me-2"></i> ê°œì¸ì •ë³´ ìˆ˜ì •
                    </a>
                </div>
            </div>
        </aside>

        <section class="col-lg-9">
            <div class="card shadow-sm border-0 min-vh-100">
                <div class="card-body p-4 p-md-5">
                    <h4 class="fw-bold mb-4 pb-2 border-bottom">ë‚´ê°€ ì“´ ë¦¬ë·°</h4>

                    <div th:if="${#lists.size(reviewList.getList())} > 0" >
                            <div th:each="review : ${reviewList.getList()}">

                                    <div class="card mb-3 border-light-subtle shadow-sm">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between mb-2">
                                                <h5 class="card-title fw-bold mb-0" ><span th:text="${review.reviewIdx}"></span><span th:text="${review.storeName}"></span></h5>
                                                <small class="text-muted" th:text="${review.createDate}">2026.02.01 ì‘ì„±</small>
                                            </div>
                                            <div class="mb-2 text-gold">í‰ì : <span class="text-dark small ms-1" th:text="${review.rating}">5.0</span></div>
                                            <div class="star-meter mb-2">
                                                <div class="stars-bg">â˜…â˜…â˜…â˜…â˜…</div>
                                                <div class="stars-fill" th:style="'width:' + (${review.rating} * 20) + '%'">â˜…â˜…â˜…â˜…â˜…</div>
                                            </div>
                                            <p class="card-text text-secondary"><span th:text="${review.comment}">êµ­ë¬¼ì´ ì •ë§ ì‹œì›í•˜ê³  ë§›ìˆì—ˆì–´ìš”. </span></p>
                                            <div class="text-end">
                                                <button class="btn btn-outline-gold btn-sm px-3 btnuptate" th:attrappend="data-storeName=${review.storeName},
                                                                   data-reviewIdx=${review.reviewIdx},data-rating=${review.rating},data-comment=${review.comment}">ë¦¬ë·°ìˆ˜ì •</button>
                                                <button class="btn btn-sm btn-outline-danger btndel2" id="" th:attrappend="id=${review.reviewIdx}">ì‚­ì œ</button>

                                            </div>
                                        </div>
                                    </div>
                            </div>

                            <!--      í˜ì´ì§€ì‹œì‘-->
                            <div class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <!--            ì´ì „ í˜ì´ì§€ ë²„íŠ¼ -->
                                    <li class="page-item" th:classappend="${reviewList.getPrePage() == 0} ? 'disabled'">
                                        <a href="#" th:href="@{/review/myreviewList(pageNum=${page},userId=${session.loginUser.userId})}" class="page-link"> &laquo;</a>
                                    </li>
                                    <!--            ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
                                    <!--          #numbers.sequence() : thymeleaf ì—ì„œ ì œê³µí•˜ëŠ” ìˆ«ì ê°ì²´ ë° ë°°ì—´ ìƒì„±í•¨ìˆ˜ -->
                                    <!--          ì²«ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ëŠ” ì‹œì‘ë²ˆí˜¸ , ë‘ë²ˆì§¸ëŠ” ì¢…ë£Œë²ˆí˜¸ -->
                                    <li class="page-item" th:each="page : ${#numbers.sequence(reviewList.getNavigateFirstPage(), reviewList.getNavigateLastPage())}" th:classappend="${page == reviewList.getPageNum()} ? 'active'">
                                        <a href="#" th:href="@{/review/myreviewList(pageNum=${page},userId=${session.loginUser.userId})}" th:text="${page}" class="page-link">1</a>
                                    </li>
                                    <!--            ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ -->
                                    <li class="page-item" th:classappend="${reviewList.getNextPage() == 0} ? 'disabled'">
                                        <a href="#" th:href="@{/review/myreviewList(pageNum=${page},userId=${session.loginUser.userId})}" class="page-link">&raquo;</a>
                                    </li>
                                </ul>
                            </div>
                        <!--      í˜ì´ì§€ë-->
                    </div>
                    <div th:unless="${#lists.size(reviewList.getList())} > 0">
                        <div class="card mb-3 border-light-subtle shadow-sm">
                            <div class="card-body">
                                <div class="text-center py-5 text-muted">ë¦¬ë·° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                            </div>
                        </div>
                    </div>



                </div>
            </div>
        </section>
    </div>
</main>

<!------------------------------------------------------------------------------------->

<div class="modal fade" id="reviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 480px;">
        <div class="modal-content rounded-4 shadow-lg border-0">

            <div class="modal-header border-bottom-0 pt-4 px-4">
                <h5 class="modal-title fw-bold fs-5">ë¦¬ë·° ìˆ˜ì •</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body px-4 pb-4">
                <h4 id="modalStoreName" class="text-center fw-bold mb-4 text-gold" style="font-size: 1.4rem;"></h4>
                <form action="/review/reviewUpdate" method="post" enctype="multipart/form-data">
                    <input type="hidden" id="modalReviewId" name="reviewIdx" value="">
                    <input type="hidden" id="modalRatingValue" name="rating" value="0">
                    <input type="hidden" id="modalImgUrl" name="imgUrl" value="" >

                    <div class="mb-4 text-center">
                        <p class="text-muted small mb-2">ì‹ì‚¬ëŠ” ë§Œì¡±ìŠ¤ëŸ¬ìš°ì…¨ë‚˜ìš”?</p>
                        <div class="stars">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                        </div>
                        <div class="hint">ë³„ì„ í´ë¦­í•˜ì—¬ ì ìˆ˜ë¥¼ ë§¤ê²¨ì£¼ì„¸ìš”.</div>


                    </div>
                    <div class="mb-3">
                        <textarea class="form-control bg-light border-0" id="modalComment" name="comment" rows="4"
                                  placeholder="ì†”ì§í•œ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”. (ìµœì†Œ 10ì ì´ìƒ)" required style="resize: none; font-size: 0.9rem;"></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="form-label text-muted small mb-1">ğŸ“· ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label>
                        <input class="form-control form-control-sm" type="file" id="uploadFiles" name="uploadFiles" accept="image/*">
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-outline-gold py-2 fw-bold"
                                style="background-color: var(--main-gold); color: white;">
                            í™• ì¸
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(function (){

        const stars = document.querySelectorAll('.stars .star');
        const ratingInput = document.getElementById('modalRatingValue');
        let selectedRating = 0;

        stars.forEach(function (star) {
            star.addEventListener('click', function () {
                selectedRating = star.dataset.value;
                ratingInput.value = selectedRating;
                updateStars(selectedRating);
            });
            // ë§ˆìš°ìŠ¤ ì˜¤ë²„
            star.addEventListener('mouseover', () => {
                updateStars(star.dataset.value);
            });

            // ë§ˆìš°ìŠ¤ ì•„ì›ƒ
            star.addEventListener('mouseout', () => {
                updateStars(selectedRating);
            });
        });

        //ë³„ì ë³€ê²½
        function updateStars(val00) {
            stars.forEach(function (star) {
                star.classList.toggle(
                    'active',
                    star.dataset.value <= val00
                );
            });
        }


        $(".btnuptate").on("click",function (){
            const test = $(this);
            const dataValue1 = test.attr("data-storeName");
            const dataValue2 = test.attr("data-reviewIdx");
            const dataValue3 = test.attr("data-rating");
            const dataValue4 = test.attr("data-comment");
            openReviewModal(dataValue1,dataValue2,dataValue3,dataValue4);

        });

        //ê²Œì‹œê¸€ ì‚­ì œ
        const btndels = document.querySelectorAll('.btndel2');
        btndels.forEach(function (delno) {
            delno.addEventListener('click', function () {
                const val=this.id;
                location.href="/review/delReview?reviewIdx="+ val ;
            });
        });


        function openReviewModal(storeName,reviewIdx,ratingVal,comment) {

            const nameElement = document.getElementById('modalStoreName');
            const idElement = document.getElementById('modalReviewId');
            const starElement = document.getElementById('modalRatingValue');
            const commElement = document.getElementById('modalComment');
            if(nameElement) nameElement.innerText = storeName;
            if(idElement) idElement.value = reviewIdx;

            if(starElement) starElement.value = ratingVal;
            if(commElement) commElement.value = comment;

            updateStars(ratingVal);
            let reviewModalElement = document.getElementById('reviewModal');
            let reviewModal = bootstrap.Modal.getInstance(reviewModalElement);

            if (!reviewModal) {

                reviewModal = new bootstrap.Modal(reviewModalElement);
            }

            reviewModal.show();
        }




    });
//


</script>
<div th:replace="~{layout/footer :: footer}"></div>
</body>
</html>